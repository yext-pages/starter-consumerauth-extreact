import { DirectAnswerType, useSearchState } from '@yext/search-headless-react';
import { useCallback } from 'react';
import { useAnalytics } from './useAnalytics';
function isDirectAnswer(data) {
    var _a, _b;
    return ((_a = data) === null || _a === void 0 ? void 0 : _a.type) === DirectAnswerType.FeaturedSnippet ||
        ((_b = data) === null || _b === void 0 ? void 0 : _b.type) === DirectAnswerType.FieldValue;
}
export function useCardAnalytics() {
    const analytics = useAnalytics();
    const verticalKey = useSearchState(state => state.vertical.verticalKey);
    const queryId = useSearchState(state => state.query.queryId);
    const reportCtaEvent = useCallback((result, eventType) => {
        let url, entityId, fieldName;
        let directAnswer = false;
        if (isDirectAnswer(result)) {
            url = result.relatedResult.link;
            entityId = result.relatedResult.id;
            fieldName = result.type === DirectAnswerType.FeaturedSnippet
                ? undefined
                : result.fieldName;
            directAnswer = true;
        }
        else {
            url = result.link;
            entityId = result.id;
        }
        if (!queryId) {
            console.error('Unable to report a CTA event. Missing field: queryId.');
            return;
        }
        if (!entityId) {
            console.error('Unable to report a CTA event. Missing field: entityId.');
            return;
        }
        analytics === null || analytics === void 0 ? void 0 : analytics.report({
            type: eventType,
            entityId,
            searcher: verticalKey ? 'VERTICAL' : 'UNIVERSAL',
            queryId,
            verticalKey: verticalKey || '',
            url,
            fieldName,
            directAnswer
        });
    }, [analytics, queryId, verticalKey]);
    const reportFeedbackEvent = useCallback((result, feedbackType) => {
        if (!queryId) {
            console.error('Unable to report a result feedback event. Missing field: queryId.');
            return;
        }
        let directAnswer = false;
        let entityId;
        if (isDirectAnswer(result)) {
            directAnswer = true;
            entityId = result.relatedResult.id;
        }
        else {
            entityId = result.id;
        }
        analytics === null || analytics === void 0 ? void 0 : analytics.report({
            type: feedbackType,
            entityId,
            searcher: verticalKey ? 'VERTICAL' : 'UNIVERSAL',
            queryId,
            verticalKey: verticalKey || '',
            directAnswer
        });
    }, [analytics, queryId, verticalKey]);
    const reportAnalyticsEvent = useCallback((cardResult, analyticsEventType) => {
        if (!analytics) {
            return;
        }
        if (analyticsEventType === 'TITLE_CLICK' || analyticsEventType === 'CTA_CLICK') {
            reportCtaEvent(cardResult, analyticsEventType);
        }
        if (analyticsEventType === 'THUMBS_DOWN' || analyticsEventType === 'THUMBS_UP') {
            reportFeedbackEvent(cardResult, analyticsEventType);
        }
    }, [analytics, reportCtaEvent, reportFeedbackEvent]);
    return reportAnalyticsEvent;
}
//# sourceMappingURL=useCardAnalytics.js.map